document.addEventListener('DOMContentLoaded', () => {
    // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º
    let showStars = true; // –ó–≤–µ–∑–¥—ã –≤—Å–µ–≥–¥–∞ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è
    let showNicknames = Math.random() < 0.25; // 25% —à–∞–Ω—Å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–∏–∫–Ω–µ–π–º–æ–≤
    const starSizeMultiplier = 3.0; // –ú–Ω–æ–∂–∏—Ç–µ–ª—å —Ä–∞–∑–º–µ—Ä–∞ –∑–≤–µ–∑–¥ (1.0 - —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ä–∞–∑–º–µ—Ä)
    
    // –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Ü–≤–µ—Ç–∞ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö –Ω–∏–∫–Ω–µ–π–º–æ–≤
    const specialColors = {
        '–•–∞–≥—Ä–∏–¥': 'rgb(255, 166, 0)', // –æ—Ä–∞–Ω–∂–µ–≤—ã–π
        'DEDFEAR': 'rgba(255, 224, 86, 0.85)', // –∫—Ä–∞—Å–Ω—ã–π
        'Evil4el': 'rgba(143, 119, 252, 0.85)', // —Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–π
        'TVPE': 'rgba(202, 122, 255, 0.85)', // –∑–µ–ª–µ–Ω—ã–π
    };
    
    const starContainer = document.createElement('div');
    starContainer.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: -1;
        overflow: hidden;
        perspective: 1000px;
    `;
    document.body.appendChild(starContainer);

    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –º–æ–±–∏–ª—å–Ω—ã–º
    const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);

    // –°–ø–∏—Å–æ–∫ —Å–ª—É—á–∞–π–Ω—ã—Ö –Ω–∏–∫–Ω–µ–π–º–æ–≤ –¥–ª—è –∑–≤–µ–∑–¥
    const nicknames = [
        'üî• –•–∞–≥—Ä–∏–¥ üî•', 'miitchull', 'DEDFEAR', 'Evil4el', 'TVPE', 'capJ', 'zaxerisimus', 'AlexanderGo77', 'RastaOwl', 'showsalmon', 'sofkabrovka', 'HallLeon', 'sanek_ludik', 'meowgreyy', 'shinobee_4sv', 'mercurrry', 'BE7HA', 'Inngvarr', 'vrednaya_zhopa', '–ì–ª—è–Ω–µ—Ü', 'ESC', 'zaruinili', 'PiKaq7', 'crystalsoncher', 'ELF0V', 'Dzeem', 'InCrit', 'Ferazelz', 'Toopenya', 'HUBIBICH', 'Gaucheboy', 'solo_mogby_bit', 'lisadess', 'wercop83', 'wladizlaw', 'eriooook', 'flur0x', 'Krizzz', 'gogomorgort', 'Lrost', 'v4nec', 'j0anans', 'Da__Co', 'showsalmon', 'laketoki', '–ö–∏—á', 'Basila', 'hpuv', 'Anonimcat', 'yournihao'
    ];

    // –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–µ –Ω–∏–∫–Ω–µ–π–º—ã –Ω–∞ —ç–∫—Ä–∞–Ω–µ
    const activeNicknames = new Set();

    class Star {
        constructor() {
            // –°–æ–∑–¥–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∑–≤–µ–∑–¥—ã –∏ –Ω–∏–∫–Ω–µ–π–º–∞
            this.container = document.createElement('div');
            this.element = document.createElement('div');
            this.nickname = document.createElement('div');
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å—ã –¥–ª—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤ (–¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤–∏–¥–∏–º–æ—Å—Ç—å—é)
            this.element.classList.add('star-element');
            this.nickname.classList.add('star-nickname');
            
            // –í—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω—ã–π –Ω–∏–∫–Ω–µ–π–º, –∫–æ—Ç–æ—Ä—ã–π –µ—â–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
            this.nickText = getAvailableNickname();
            
            // –£–º–µ–Ω—å—à–∞–µ–º —Ä–∞–∑–º–µ—Ä –∑–≤–µ–∑–¥ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö
            this.size = (Math.random() * (isMobile ? 0.15 : 0.2) + (isMobile ? 0.05 : 0.1)) * starSizeMultiplier;
            
            // –†–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ–º –∑–≤–µ–∑–¥—ã –ø–æ –≤—Å–µ–º—É —ç–∫—Ä–∞–Ω—É
            const margin = isMobile ? 20 : 50;
            this.x = margin + Math.random() * (window.innerWidth - margin * 2);
            this.y = margin + Math.random() * (window.innerHeight - margin * 2);
            
            // –ù–∞—á–∏–Ω–∞–µ–º —Å —Ä–∞–∑–Ω—ã—Ö Z-–∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –¥–ª—è –±–æ–ª–µ–µ —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–≥–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è
            this.z = -500 + Math.random() * 300;
            
            // –î–≤–∏–∂–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –≤–ø–µ—Ä–µ–¥ —Å –Ω–µ–±–æ–ª—å—à–∏–º —Ä–∞–∑–±—Ä–æ—Å–æ–º
            // –£–º–µ–Ω—å—à–∞–µ–º —Ä–∞–∑–±—Ä–æ—Å –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö
            const spread = isMobile ? 0.1 : 0.15;
            this.vx = (Math.random() - 0.5) * spread;
            this.vy = (Math.random() - 0.5) * spread;
            // –£–º–µ–Ω—å—à–∞–µ–º —Å–∫–æ—Ä–æ—Å—Ç—å –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö
            // –°–∫–æ—Ä–æ—Å—Ç—å —Ç–µ–ø–µ—Ä—å –≤ –µ–¥–∏–Ω–∏—Ü–∞—Ö –≤ —Å–µ–∫—É–Ω–¥—É, –∞ –Ω–µ –≤ –∫–∞–¥—Ä
            this.vz = isMobile ? 90 : 120;
            this.vx *= 60; // –£–º–Ω–æ–∂–∞–µ–º –Ω–∞ 60, —á—Ç–æ–±—ã –ø–µ—Ä–µ–≤–µ—Å—Ç–∏ –≤ –µ–¥–∏–Ω–∏—Ü—ã –≤ —Å–µ–∫—É–Ω–¥—É
            this.vy *= 60; // –£–º–Ω–æ–∂–∞–µ–º –Ω–∞ 60, —á—Ç–æ–±—ã –ø–µ—Ä–µ–≤–µ—Å—Ç–∏ –≤ –µ–¥–∏–Ω–∏—Ü—ã –≤ —Å–µ–∫—É–Ω–¥—É
            
            // –°—Ç–∏–ª–∏ –¥–ª—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
            this.container.style.cssText = `
                position: absolute;
                transform: translate3d(${this.x}px, ${this.y}px, ${this.z}px);
                display: flex;
                flex-direction: column;
                align-items: center;
                opacity: 0;
                transition: opacity 0.8s ease-in-out;
            `;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Ü–≤–µ—Ç –¥–ª—è –¥–∞–Ω–Ω–æ–≥–æ –Ω–∏–∫–Ω–µ–π–º–∞
            const nicknameColor = specialColors[this.nickText] || 'rgba(255, 255, 255, 0.85)';
            
            // –ü–æ–ª—É—á–∞–µ–º —Ü–≤–µ—Ç –¥–ª—è —Å–≤–µ—á–µ–Ω–∏—è (–±–µ–∑ –∞–ª—å—Ñ–∞-–∫–∞–Ω–∞–ª–∞)
            // –ï—Å–ª–∏ —ç—Ç–æ RGB —Ü–≤–µ—Ç, –∏—Å–ø–æ–ª—å–∑—É–µ–º –µ–≥–æ, –∏–Ω–∞—á–µ –∏–∑–≤–ª–µ–∫–∞–µ–º RGB –∏–∑ RGBA
            let glowColor;
            if (nicknameColor.startsWith('rgb(')) {
                glowColor = nicknameColor;
            } else if (nicknameColor.startsWith('rgba(')) {
                // –ò–∑–≤–ª–µ–∫–∞–µ–º RGB —á–∞—Å—Ç—å –∏–∑ RGBA
                glowColor = 'rgb(' + nicknameColor.substring(5, nicknameColor.lastIndexOf(',')) + ')';
            } else {
                // –ï—Å–ª–∏ —Ñ–æ—Ä–º–∞—Ç –Ω–µ–∏–∑–≤–µ—Å—Ç–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ–º –±–µ–ª—ã–π —Ü–≤–µ—Ç
                glowColor = 'rgb(255, 255, 255)';
            }
            
            // –£–ø—Ä–æ—â–∞–µ–º —Å—Ç–∏–ª–∏ –¥–ª—è –∑–≤–µ–∑–¥—ã
            this.element.style.cssText = `
                width: ${this.size}px;
                height: ${this.size}px;
                background: ${glowColor.replace('rgb', 'rgba').replace(')', ', 0.95)')};
                border-radius: 50%;
                ${isMobile ? '' : `box-shadow: 0 0 ${this.size * 5}px ${glowColor};`}
                ${isMobile ? '' : `filter: blur(${this.size * 0.03}px);`}
                display: block; // –ó–≤–µ–∑–¥—ã –≤—Å–µ–≥–¥–∞ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è
            `;
            
            // –°—Ç–∏–ª–∏ –¥–ª—è –Ω–∏–∫–Ω–µ–π–º–∞
            this.nickname.style.cssText = `
                color: ${nicknameColor};
                font-size: ${isMobile ? '4px' : '5px'};
                font-weight: 600;
                margin-bottom: 3px;
                white-space: nowrap;
                text-shadow: 0 0 3px ${glowColor};
                font-family: 'Montserrat', sans-serif;
                display: ${showNicknames ? 'block' : 'none'};
            `;
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ–∫—Å—Ç –Ω–∏–∫–Ω–µ–π–º–∞
            this.nickname.textContent = this.nickText;
            
            // –î–æ–±–∞–≤–ª—è–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã –≤ DOM
            this.container.appendChild(this.nickname);
            this.container.appendChild(this.element);
            starContainer.appendChild(this.container);
            
            // –í–∞–∂–Ω–æ! –ò—Å–ø–æ–ª—å–∑—É–µ–º requestAnimationFrame –≤–º–µ—Å—Ç–æ setTimeout –¥–ª—è –±–æ–ª–µ–µ –ø–ª–∞–≤–Ω–æ–π –∞–Ω–∏–º–∞—Ü–∏–∏
            requestAnimationFrame(() => {
                this.container.style.opacity = '1';
            });
        }

        move(deltaTime) {
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º deltaTime –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è
            // deltaTime –≤ —Å–µ–∫—É–Ω–¥–∞—Ö, –ø–æ—ç—Ç–æ–º—É —É–º–Ω–æ–∂–∞–µ–º —Å–∫–æ—Ä–æ—Å—Ç—å –Ω–∞ deltaTime
            this.x += this.vx * deltaTime;
            this.y += this.vy * deltaTime;
            this.z += this.vz * deltaTime;
            
            if (this.z > 1000) {
                this.fadeOut();
                return false;
            }
            
            // –£–±–∏—Ä–∞–µ–º scale –∏–∑ transform –¥–ª—è –ª—É—á—à–µ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
            this.container.style.transform = `translate3d(${this.x}px, ${this.y}px, ${this.z}px)`;
            return true;
        }

        fadeOut() {
            // –û—Å–≤–æ–±–æ–∂–¥–∞–µ–º –Ω–∏–∫–Ω–µ–π–º –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
            activeNicknames.delete(this.nickText);
            
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º requestAnimationFrame –¥–ª—è –±–æ–ª–µ–µ –ø–ª–∞–≤–Ω–æ–≥–æ –∏—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏—è
            requestAnimationFrame(() => {
                this.container.style.opacity = '0';
                
                // –£–¥–∞–ª—è–µ–º —ç–ª–µ–º–µ–Ω—Ç –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∞–Ω–∏–º–∞—Ü–∏–∏
                setTimeout(() => this.container.remove(), 400);
            });
        }
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–Ω–æ–≥–æ –Ω–∏–∫–Ω–µ–π–º–∞
    function getAvailableNickname() {
        // –°–æ–∑–¥–∞–µ–º –º–∞—Å—Å–∏–≤ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –Ω–∏–∫–Ω–µ–π–º–æ–≤ (—Ç–µ—Ö, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è)
        const availableNicknames = nicknames.filter(nick => !activeNicknames.has(nick));
        
        // –ï—Å–ª–∏ –≤—Å–µ –Ω–∏–∫–Ω–µ–π–º—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —Å–ª—É—á–∞–π–Ω—ã–π –∏–∑ –≤—Å–µ–≥–æ —Å–ø–∏—Å–∫–∞
        if (availableNicknames.length === 0) {
            return nicknames[Math.floor(Math.random() * nicknames.length)];
        }
        
        // –í—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω—ã–π –Ω–∏–∫–Ω–µ–π–º –∏–∑ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö
        const selectedNick = availableNicknames[Math.floor(Math.random() * availableNicknames.length)];
        
        // –î–æ–±–∞–≤–ª—è–µ–º –µ–≥–æ –≤ —Å–ø–∏—Å–æ–∫ –∞–∫—Ç–∏–≤–Ω—ã—Ö
        activeNicknames.add(selectedNick);
        
        return selectedNick;
    }

    const stars = new Set();
    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–≤–µ–∑–¥ —Ä–∞–≤–Ω—ã–º –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –Ω–∏–∫–Ω–µ–π–º–æ–≤
    // –ù–æ –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
    const MAX_STARS = isMobile ? Math.min(30, nicknames.length) : nicknames.length;
    let lastCreateTime = 0;

    // –î–æ–±–∞–≤–ª—è–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∏
    let isScrolling = false;
    let scrollTimeout;

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø—Ä–æ–∫—Ä—É—Ç–∫–∏
    window.addEventListener('scroll', () => {
        isScrolling = true;
        clearTimeout(scrollTimeout);
        scrollTimeout = setTimeout(() => {
            isScrolling = false;
        }, 200);
    });

    function createStar() {
        const now = Date.now();
        // –£–º–µ–Ω—å—à–∞–µ–º –∏–Ω—Ç–µ—Ä–≤–∞–ª —Å–æ–∑–¥–∞–Ω–∏—è –∑–≤–µ–∑–¥ –¥–ª—è –±–æ–ª–µ–µ —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–≥–æ –ø–æ—è–≤–ª–µ–Ω–∏—è
        if (now - lastCreateTime < (isMobile ? 100 : 30)) return;
        
        if (stars.size < MAX_STARS) {
            stars.add(new Star());
            lastCreateTime = now;
        }
    }

    // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ deltaTime
    let lastTime = 0;

    function animate(currentTime) {
        // –†–∞—Å—á–µ—Ç deltaTime –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
        if (!lastTime) lastTime = currentTime;
        const deltaTime = (currentTime - lastTime) / 1000; // –ü–µ—Ä–µ–≤–æ–¥–∏–º –≤ —Å–µ–∫—É–Ω–¥—ã
        lastTime = currentTime;
        
        // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º deltaTime, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –±–æ–ª—å—à–∏—Ö —Å–∫–∞—á–∫–æ–≤
        // –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –≤–∫–ª–∞–¥–æ–∫ –∏–ª–∏ –Ω–∏–∑–∫–æ–º FPS
        const clampedDeltaTime = Math.min(deltaTime, 0.1);
        
        // –ù–µ —Å–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–µ –∑–≤–µ–∑–¥—ã –≤–æ –≤—Ä–µ–º—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö
        if (!(isMobile && isScrolling)) {
            createStar();
        }
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –∫–∞–∂–¥—ã–π –≤—Ç–æ—Ä–æ–π –∫–∞–¥—Ä –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö
        if (!(isMobile && isScrolling)) {
            stars.forEach(star => {
                if (!star.move(clampedDeltaTime)) {
                    stars.delete(star);
                }
            });
        }
        
        requestAnimationFrame(animate);
    }

    // –°–æ–∑–¥–∞–µ–º –Ω–∞—á–∞–ª—å–Ω—ã–µ –∑–≤–µ–∑–¥—ã —Å –±–æ–ª–µ–µ —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω—ã–º —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º –ø–æ –≤—Ä–µ–º–µ–Ω–∏ –∏ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤—É
    // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–∞—á–∞–ª—å–Ω—ã—Ö –∑–≤–µ–∑–¥ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –Ω–∏–∫–Ω–µ–π–º–æ–≤
    const initialStarCount = Math.min(isMobile ? 30 : 60, MAX_STARS);
    
    // –°–æ–∑–¥–∞–µ–º –Ω–∞—á–∞–ª—å–Ω—ã–µ –∑–≤–µ–∑–¥—ã —Å —Ä–∞–∑–Ω—ã–º–∏ Z-–∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º–∏ –¥–ª—è —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–≥–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è
    for (let i = 0; i < initialStarCount; i++) {
        // –°–æ–∑–¥–∞–µ–º –∑–≤–µ–∑–¥—ã —Å—Ä–∞–∑—É, –Ω–æ —Å —Ä–∞–∑–Ω—ã–º–∏ –Ω–∞—á–∞–ª—å–Ω—ã–º–∏ –ø–æ–∑–∏—Ü–∏—è–º–∏
        setTimeout(() => {
            const star = new Star();
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ä–∞–∑–Ω—ã–µ Z-–∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –¥–ª—è –Ω–∞—á–∞–ª—å–Ω—ã—Ö –∑–≤–µ–∑–¥
            star.z = -500 + (i / initialStarCount) * 1500;
            stars.add(star);
        }, Math.random() * 500); // –ù–µ–±–æ–ª—å—à–∞—è —Å–ª—É—á–∞–π–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –±–æ–ª–µ–µ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –ø–æ—è–≤–ª–µ–Ω–∏—è
    }

    // –ó–∞–ø—É—Å–∫–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é —Å –ø–µ—Ä–µ–¥–∞—á–µ–π —Ç–µ–∫—É—â–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
    requestAnimationFrame(animate);

    // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é, –∫–æ–≥–¥–∞ –≤–∫–ª–∞–¥–∫–∞ –Ω–µ–∞–∫—Ç–∏–≤–Ω–∞
    document.addEventListener('visibilitychange', () => {
        if (document.hidden) {
            stars.forEach(star => {
                // –û—Å–≤–æ–±–æ–∂–¥–∞–µ–º –≤—Å–µ –Ω–∏–∫–Ω–µ–π–º—ã
                activeNicknames.delete(star.nickText);
                star.fadeOut();
            });
            stars.clear();
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º lastTime –ø—Ä–∏ –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏–∏ –Ω–∞ –≤–∫–ª–∞–¥–∫—É
            lastTime = 0;
        }
    });

    // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏–∏ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
    if (isMobile) {
        window.addEventListener('orientationchange', () => {
            // –î–∞–µ–º –≤—Ä–µ–º—è –Ω–∞ –ø–µ—Ä–µ—Ä–∏—Å–æ–≤–∫—É –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏–∏
            setTimeout(() => {
                // –£–¥–∞–ª—è–µ–º –∑–≤–µ–∑–¥—ã, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –æ–∫–∞–∑–∞—Ç—å—Å—è –∑–∞ –ø—Ä–µ–¥–µ–ª–∞–º–∏ —ç–∫—Ä–∞–Ω–∞
                stars.forEach(star => {
                    if (star.x < 0 || star.x > window.innerWidth || 
                        star.y < 0 || star.y > window.innerHeight) {
                        // –û—Å–≤–æ–±–æ–∂–¥–∞–µ–º –Ω–∏–∫–Ω–µ–π–º
                        activeNicknames.delete(star.nickText);
                        star.fadeOut();
                        stars.delete(star);
                    }
                });
            }, 100);
        });
    }
});
